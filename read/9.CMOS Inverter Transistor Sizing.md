# CMOS Inverter Transistor Sizing: Switching Voltage and Noise Margin

This document explains how the relationship between KN and KP affects the switching voltage (VM), and why this drives the sizing decisions for NMOS and PMOS transistors in a CMOS inverter.

---

## 1. Recap: Why Sizing Matters

The electrical parameters of a CMOS inverter — particularly the transconductance parameters KN and KP — directly affect the switching voltage VM. VM determines what the digital logic interprets as a logic 1 or logic 0, which in turn governs the noise margin and reliability of the circuit.

---

## 2. The Switching Voltage Equation

The switching voltage VM is found by setting the NMOS and PMOS drain currents equal at the point where Vout = Vin = VM, then solving for VM. Both transistors are in saturation at this point, so their current equations take the form:

```
ID = (K / 2) · (VGS − VT)²
```

Setting ID_N = ID_P and solving for VM yields the master equation that governs all sizing decisions:

```
        VTN + √(KN/KP) · (VDD + VTP)
VM = ─────────────────────────────────
            1 + √(KN/KP)
```

### Parameters

| Symbol | Meaning |
|--------|---------|
| **VM** | Switching voltage — the input voltage where Vout = Vin |
| **VTN** | NMOS threshold voltage (positive) |
| **VTP** | PMOS threshold voltage (negative) |
| **VDD** | Supply voltage |
| **KN** | NMOS transconductance parameter = (W/L)_N · μN · Cox |
| **KP** | PMOS transconductance parameter = (W/L)_P · μP · Cox |

The ratio **√(KN/KP)** is the key term. Its value relative to 1 determines where VM lands in the supply range, and everything in the next section follows directly from manipulating it.

---

## 3. Effect of KN and KP on Switching Voltage

The three cases below are each derived by taking the master equation above and evaluating what happens as √(KN/KP) approaches infinity, zero, or 1:

### Case 1: KN >> KP

When KN is much greater than KP, the ratio term in the VM expression approaches zero. The threshold terms and the ratio cancel out, leaving:

```
VM ≈ VTN
```

The switching point collapses down to near the NMOS threshold voltage. This leaves very little room for a valid logic 1 representation — poor noise margin on the high side.

### Case 2: KN << KP

When KN is much less than KP, the ratio term becomes very large, dominating both the numerator and denominator. The ratio cancels itself out, leaving:

```
VM ≈ VDD + VTP
```

Since VTP is negative, this pushes VM very close to VDD. This leaves very little room for a valid logic 0 representation — poor noise margin on the low side.

### Case 3: KN = KP (Best Case)

When KN equals KP, the ratio term equals 1 and simplifies out. The expression becomes:

```
VM ≈ (VTN + VDD + VTP) / 2
```

In most processes, VTN and VTP are approximately equal in magnitude but opposite in sign (e.g., VTN ≈ −VTP). The threshold terms cancel in the numerator, giving:

```
VM ≈ VDD / 2
```

This is the ideal switching point. It splits the voltage range evenly:

| Logic Level | Voltage Range |
|-------------|---------------|
| Logic 0     | 0 to VDD/2    |
| Logic 1     | VDD/2 to VDD  |

This maximizes the noise margin on both sides and is the target for a well-designed CMOS inverter.

---

## 4. Making KN Equal to KP: The Sizing Problem

KN and KP are defined as:

```
KN = (W/L)_N · μN · Cox
KP = (W/L)_P · μP · Cox
```

The designer controls W/L. The foundry/PDK fixes μ and Cox. The key fact from device physics is:

> **Electron mobility (μN) is approximately 2–3× greater than hole mobility (μP).**

This means that if NMOS and PMOS have the same W/L, KN will naturally be larger than KP. To equalize them, we need to compensate by making the PMOS wider.

Setting KN = KP and canceling the common Cox term:

```
(W/L)_N · μN = (W/L)_P · μP
```

Since μN ≈ 2·μP (using 2× as a practical approximation):

```
(W/L)_P = 2 · (W/L)_N
```

**The PMOS must be sized at least twice the width of the NMOS.**

---

## 5. Physical Intuition

Electron mobility being higher means NMOS is inherently faster than PMOS. In a CMOS inverter, both transistors need to operate at the same effective speed for the output to switch symmetrically.

To compensate for the slower PMOS, we increase its **width** — not its length. Making it wider allows more carriers (holes) to flow through, effectively matching its drive strength to the NMOS.

> **Why width and not length?**
> The channel length is typically tied to the process node (e.g., 300 nm) and is kept the same for all transistors in a design. Width is the free variable used for sizing.

---

## 6. Sizing Example

Using a 300 nm process node as the fixed length:

| Transistor | Width (W) | Length (L) | Ratio (W/L) |
|------------|-----------|------------|--------------|
| NMOS       | 1 μm      | 0.3 μm     | 3.33         |
| PMOS       | 2 μm      | 0.3 μm     | 6.67         |

The PMOS width is set to **2× the NMOS width**, keeping the length fixed at the process node value for both.

### How to set this in Xschem

1. Double-click on the NMOS transistor.
2. Set **L** (length) to `0.3u` (300 nm).
3. Set **W** (width) to `1u` (1 μm).
4. Press OK.
5. Double-click on the PMOS transistor.
6. Set **L** to `0.3u` (same as NMOS).
7. Set **W** to `2u` (2 μm — twice the NMOS width).
8. Press OK.

> **Note on NF and M:** The MOSFET symbol in Xschem also has **NF** (number of fingers) and **M** (multiplicity) parameters. These are primarily layout-level optimizations used to physically divide a large transistor into smaller parallel sections to reduce die area. For simulation purposes, focus on W and L.

---

## 7. Summary

| Design Goal | Action |
|-------------|--------|
| Maximize noise margin | Set VM = VDD / 2 |
| Achieve VM = VDD / 2 | Make KN = KP |
| Make KN = KP | Size PMOS width ≥ 2× NMOS width |
| Keep process consistent | Fix length (L) to the process node for both transistors |
| Compensate for slower PMOS | Increase PMOS width, not length |